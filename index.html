<!DOCTYPE html>
<html lang="it" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Artemisia Story ¬∑ Generatore & Trasformatore di immagini AI</title>

  <!-- Favicon reale -->
  <link rel="icon" type="image/png" href="/logo-artemisia.png" />

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --space-1:4px;--space-2:8px;--space-3:12px;--space-4:16px;--space-5:20px;--space-6:24px;--space-8:32px;
      --text-xs:12px;--text-sm:14px;--text-base:16px;--text-lg:18px;--text-xl:20px;--text-2xl:24px;--text-3xl:30px;
      --touch:44px;--touch-sm:36px;
      --bg-start:#0f172a;--bg-end:#1e1b4b;--card:#0b1020dd;--text:#e2e8f0;--muted:#94a3b8;--subtle:#64748b;
      --brand:#8b5cf6;--brand-2:#eab308;--accent:#eab308;--ring:rgba(139,92,246,.4);
      --ok:#10b981;--warn:#f59e0b;--err:#ef4444;--surface:rgba(255,255,255,.08);--surface-h:rgba(255,255,255,.12);
      --border:rgba(255,255,255,.16);--border-f:rgba(139,92,246,.5);--shadow:0 20px 60px rgba(0,0,0,.4);
    }
    [data-theme="light"]{
      --bg-start:#e2e8f0;--bg-end:#c7d2fe;--card:#ffffffee;--text:#0f172a;--muted:#475569;--subtle:#64748b;
      --surface:rgba(2,6,23,.04);--surface-h:rgba(2,6,23,.08);--border:rgba(2,6,23,.12);--shadow:0 20px 60px rgba(2,6,23,.15);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Inter',system-ui,-apple-system,sans-serif;font-size:var(--text-sm);color:var(--text);background:
      radial-gradient(1000px 600px at -10% -10%, #0ea5e980, transparent 60%),
      radial-gradient(800px 500px at 110% 10%, #a78bfa66, transparent 60%),
      linear-gradient(135deg,var(--bg-start),var(--bg-end));-webkit-font-smoothing:antialiased;overflow-x:hidden}
    .container{max-width:1200px;margin:0 auto;padding:var(--space-6)}
    @media(max-width:768px){.container{padding:var(--space-4)}}
    .header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:22px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:12px;min-width:0}
    .logo{width:44px;height:44px;border-radius:12px;background:var(--surface);display:grid;place-items:center;overflow:hidden}
    .logo img{width:100%;height:100%;object-fit:contain}
    .title{font-size:clamp(var(--text-xl),4vw,var(--text-3xl));font-weight:800;letter-spacing:-.02em;margin:0}
    .subtitle{font-size:12px;color:var(--muted);margin-top:2px}
    .actions{display:flex;gap:8px}
    .icon-btn{min-width:var(--touch);min-height:var(--touch);border:1px solid var(--border);background:var(--surface);color:var(--text);border-radius:12px;display:grid;place-items:center;cursor:pointer;transition:.2s}
    .icon-btn:hover{transform:translateY(-1px);border-color:var(--accent);background:var(--surface-h)}
    .grid{display:grid;grid-template-columns:1.05fr .95fr;gap:20px}
    @media(max-width:1024px){.grid{grid-template-columns:1fr;gap:24px}}
    .card{background:var(--card);backdrop-filter:blur(16px);border:1px solid var(--border);border-radius:20px;box-shadow:var(--shadow);padding:22px}
    .section-title{font-weight:700;margin-bottom:10px}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0 14px}
    .chip{min-height:var(--touch-sm);padding:8px 12px;border:1px solid var(--border);background:var(--surface);border-radius:999px;font-size:12px;cursor:pointer;transition:.2s}
    .chip:hover{background:var(--surface-h);border-color:var(--brand);transform:translateY(-1px)}
    .chip.active{outline:2px solid var(--ring);border-color:transparent;background:rgba(139,92,246,.2)}
    .controls{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0}
    .select,.slider{display:flex;align-items:center;gap:8px;min-height:var(--touch);border:1px solid var(--border);background:var(--surface);padding:0 12px;border-radius:12px}
    .select select,.select input{background:transparent;border:none;color:var(--text);font-size:14px}
    .slider input{accent-color:var(--brand);flex:1}
    .slider span{font-size:12px;color:var(--muted);min-width:50px;text-align:right}
    .textarea{position:relative;margin:16px 0}
    textarea{width:100%;min-height:140px;resize:vertical;border:2px solid transparent;border-radius:16px;padding:16px;background:var(--surface);color:var(--text)}
    textarea:focus{outline:none;box-shadow:0 0 0 4px var(--ring);border-color:var(--border-f)}
    textarea::placeholder{color:var(--muted)}
    .counter{position:absolute;right:12px;bottom:8px;font-size:12px;color:var(--subtle)}
    .btns{display:flex;flex-wrap:wrap;gap:8px;margin-top:14px}
    .btn{display:inline-flex;align-items:center;gap:8px;min-height:var(--touch);padding:0 16px;border-radius:12px;border:1px solid var(--border);cursor:pointer;background:var(--surface);color:var(--text);font-weight:600}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .btn.primary{background:linear-gradient(135deg,var(--brand),var(--brand-2));border-color:transparent;color:#fff;box-shadow:0 10px 24px rgba(139,92,246,.4)}
    .btn.primary:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 15px 35px rgba(139,92,246,.5)}
    .frame{position:relative;background:linear-gradient(135deg,#0b1020,#1f2937);border:2px solid var(--border);border-radius:18px;display:grid;place-items:center;overflow:hidden;min-height:220px;cursor:pointer}
    .frame img{max-width:100%;max-height:100%;display:none;border-radius:12px}
    .frame img.show{display:block;animation:fadeIn .35s ease-out}
    @keyframes fadeIn{from{opacity:0;transform:scale(.98)}to{opacity:1;transform:scale(1)}}
    .placeholder{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;color:var(--muted)}
    .spinner{width:54px;height:54px;border-radius:50%;border:4px solid rgba(255,255,255,.2);border-top-color:var(--brand);animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .progress{position:absolute;left:0;bottom:0;height:4px;width:0;background:linear-gradient(90deg,var(--brand),var(--accent));transition:width .3s ease;border-radius:0 0 16px 16px}
    .history-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px}
    .card-thumb{position:relative;background:var(--surface);border:1px solid var(--border);border-radius:14px;overflow:hidden;cursor:pointer}
    .card-thumb img{width:100%;height:140px;object-fit:cover}
    .thumb-actions{position:absolute;right:8px;bottom:8px;display:flex;gap:6px;opacity:0;transition:opacity .2s}
    .card-thumb:hover .thumb-actions{opacity:1}
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="brand">
        <div class="logo"><img src="/logo-artemisia.png" alt="Artemisia Story" /></div>
        <div>
          <div class="title">Artemisia Story</div>
          <div class="subtitle">Generatore & Trasformatore di immagini AI</div>
        </div>
      </div>
      <div class="actions">
        <button class="icon-btn" id="themeBtn" title="Tema">üåó</button>
        <button class="icon-btn" id="helpBtn" title="Guida">‚ùî</button>
      </div>
    </header>

    <main class="grid">
      <!-- Sinistra -->
      <section class="card">
        <div class="section-title">‚ú® Scrivi il tuo prompt</div>
        <div class="chips">
          <button class="chip" data-style="in stile cartoon moderno">Cartoon</button>
          <button class="chip" data-style="fotorealistico, illuminazione cinematografica">Fotorealistico</button>
          <button class="chip" data-style="in stile acquerello morbido">Acquerello</button>
          <button class="chip" data-style="in stile Studio Ghibli, colori pastello, mano dipinta">Ghibli</button>
        </div>
        <div class="textarea">
          <textarea id="prompt" placeholder="Es.: Un angelo al tramonto su una collina, atmosfera serena."></textarea>
          <div class="counter" id="counter">0/500</div>
        </div>
        <div class="btns">
          <button class="btn primary" id="generateBtn">üé® Genera</button>
        </div>
        <div id="status" class="status"></div>
      </section>

      <!-- Destra -->
      <section class="card">
        <div class="section-title">üñºÔ∏è Anteprima</div>
        <div class="frame" id="frame">
          <img id="resultImg" alt="" />
          <div class="placeholder" id="placeholder">
            <div class="spinner" id="spinner" style="display:none"></div>
            <div id="phContent">Nessuna immagine ancora</div>
          </div>
          <div class="progress" id="progress"></div>
        </div>
        <div class="history">
          <div class="section-title">üïò Cronologia</div>
          <div class="history-grid" id="historyGrid">
            <div style="grid-column:1/-1;text-align:center;padding:20px">Nessuna generazione ancora</div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    const BASE = (location.hostname==='localhost'||location.protocol==='file:') ? 'http://localhost:3000' : '';
    const GEN_URL  = `${BASE}/api/generate`;
    const EDIT_URL = `${BASE}/api/edit`;

    let currentImage=null, history=[];

    function showStatus(msg,type='success'){
      const s=document.getElementById('status');
      s.style.display='block'; s.textContent=msg;
      s.className='status '+type;
    }
    function updateCounter(){
      const p=document.getElementById('prompt');
      const c=document.getElementById('counter');
      const n=p.value.length;
      c.textContent=`${n}/500`;
    }
    function handleChipToggle(chip){
      const promptEl=document.getElementById('prompt');
      const style=(chip.dataset.style||'').trim();
      chip.classList.toggle('active');
      if(chip.classList.contains('active')){
        promptEl.value += (promptEl.value?', ':'')+style;
      }else{
        promptEl.value=promptEl.value.replace(style,'').replace(/\s{2,}/g,' ').trim();
      }
      updateCounter();
    }
    async function handleGenerate(){
      const basePrompt=document.getElementById('prompt').value.trim();
      if(!basePrompt){showStatus('Prompt mancante','error');return;}
      showStatus('Generazione...','loading');
      try{
        const res=await fetch(GEN_URL,{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({prompt:basePrompt})
        });
        const data=await res.json();
        if(!res.ok) throw new Error(data.error||'Errore');
        const url=data.image_url;
        displayImage(url);
        addToHistory(url,basePrompt);
        showStatus('‚úÖ Fatto!');
      }catch(e){showStatus('‚ùå '+e.message,'error');}
    }
    function displayImage(url){
      const img=document.getElementById('resultImg');
      const ph=document.getElementById('placeholder');
      img.onload=()=>{img.style.display='block'; ph.style.display='none';};
      img.src=url; currentImage=url;
    }
    function addToHistory(url,prompt){
      history.unshift({url,prompt});
      renderHistory();
    }
    function renderHistory(){
      const g=document.getElementById('historyGrid');
      g.innerHTML=history.map(h=>`<div class="card-thumb"><img src="${h.url}"></div>`).join('');
    }
    document.addEventListener('DOMContentLoaded',()=>{
      document.getElementById('generateBtn').addEventListener('click',handleGenerate);
      document.querySelectorAll('.chip').forEach(ch=>ch.addEventListener('click',()=>handleChipToggle(ch)));
      document.getElementById('prompt').addEventListener('input',updateCounter);
    });
  </script>
</body>
</html>
